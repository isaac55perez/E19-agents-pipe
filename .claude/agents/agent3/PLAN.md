# Agent3: Excel Greeting Transformer Skill

## Overview

Transform Excel files containing student grades into personalized greeting messages based on performance tiers. This agent reads analyzed repository grades and generates celebrity-style greeting messages to motivate and celebrate students.

## Purpose

The Excel Greeting Transformer adds context-aware, personality-driven greeting messages to grade data:
- **Low performers** (grades 0-60): Receive energetic, comedic Eddie Murphy-style encouragement
- **High performers** (grades 60+): Receive confident, celebratory Donald Trump-style congratulations

## Input/Output

### Input File
- **Path**: `output/output23.xlsx` (relative to project root)
- **Source**: Generated by Agent2 (Repository Python Analyzer)
- **Required Columns**: All columns from Agent2, must include a 'grade' column
- **Expected Data**:
  ```
  | ID | Date | Subject | Repo URL | Success | grade |
  |----+------+---------+----------+---------+-------|
  | 1  | ... | ... | ... | 1 | 80.00 |
  | 2  | ... | ... | ... | 1 | 0.00 |
  | 3  | ... | ... | ... | 1 | 66.67 |
  ```

### Output File
- **Path**: `output/output34.xlsx` (relative to project root)
- **New Column**: 'greeting' added at the end
- **Preserved Data**: All original columns remain unchanged
- **Output Example**:
  ```
  | ID | Date | Subject | Repo URL | Success | grade | greeting |
  |----+------+---------+----------+---------+-------+----------|
  | 1  | ... | ... | ... | 1 | 80.00 | Tremendous work, fantastic execution! |
  | 2  | ... | ... | ... | 1 | 0.00 | Hey hey, keep it funky, you got this! |
  ```

## Greeting Generation Logic

### Grade Range: 0-60 (Eddie Murphy Style)
Characteristics:
- Energetic and upbeat tone
- Comedic and playful humor
- Motivational despite lower performance
- Casual, friendly language
- References to funk, fun, or staying positive

Examples:
- "Hey hey, keep it funky! You got the moves, now let's work on the code!"
- "Let's turn that grade around! You've got the talent, just need to unlock it!"
- "Don't let this slow you down! Every master was once a beginner. Keep grinding!"

### Grade Range: >60 (Donald Trump Style)
Characteristics:
- Confident and assertive tone
- Uses superlatives (tremendous, fantastic, incredible, beautiful, winning)
- Deal-making/business language
- Celebratory and proud
- References to success and achievement

Examples:
- "Fantastic work! You're a winner, and these grades prove it. Tremendous execution!"
- "Incredible job on this repository! You're going to do great things. Believe me!"
- "The best performers understand quality code. You've got it. Keep winning!"

## Data Processing Steps

1. **Read Excel File**
   - Load `output/output23.xlsx` using openpyxl
   - Parse headers and identify the 'grade' column
   - Read all data rows

2. **Validate Data**
   - Verify 'grade' column exists
   - Check all grade values are numeric (0-100)
   - Confirm row count matches expectations

3. **Generate Greetings**
   - For each row, evaluate grade value
   - Generate appropriate personality-style greeting
   - Store greeting in memory

4. **Create Output File**
   - Create new workbook
   - Copy all headers from input
   - Add 'greeting' column header
   - Write all data rows with new greeting column
   - Format columns appropriately

5. **Save and Verify**
   - Write to `output/output34.xlsx`
   - Verify file exists and is readable
   - Confirm row count matches input

## Usage

### Running Agent3
```bash
cd /mnt/e/projects/AI/E19_agents_pipe/.claude/agents/agent3
python main.py
```

### With Options
```bash
# Custom input file
python main.py --input custom_grades.xlsx

# Custom output file
python main.py --output results.xlsx

# Both input and output
python main.py --input input.xlsx --output output.xlsx

# Verbose logging
python main.py --verbose
```

### As Part of Complete Pipeline
```bash
# After running Agent2:
/build_agent2

# Then run Agent3:
/build_agent3
```

## Error Handling

### Common Issues and Solutions

| Issue | Cause | Solution |
|-------|-------|----------|
| Input file not found | Agent2 hasn't run yet | Run Agent2 first to generate output23.xlsx |
| Missing 'grade' column | Input file format incorrect | Verify Agent2 ran successfully |
| Non-numeric grades | Data corruption or type error | Check output23.xlsx for invalid values |
| Write permission denied | Output directory not writable | Check permissions on output/ directory |
| Empty input file | No data rows in input | Verify Agent2 processed entries successfully |

### Error Messages
- `FileNotFoundError`: Input file missing - run Agent2 first
- `ValueError`: Grade column missing or invalid format
- `PermissionError`: Cannot write to output directory
- `IOError`: Excel file is corrupted

## Validation Checklist

After running Agent3, verify:

- [ ] Output file `output/output34.xlsx` exists
- [ ] File has correct number of rows (matches input)
- [ ] All original columns are preserved
- [ ] New 'greeting' column exists
- [ ] Greeting messages are non-empty for all rows
- [ ] Eddie Murphy style used for grades 0-60
- [ ] Donald Trump style used for grades >60
- [ ] No data corruption in original columns
- [ ] File is readable and not corrupted

## Performance Characteristics

- **Time Complexity**: O(n) where n = number of rows
- **Space Complexity**: O(n) for storing greetings
- **Typical Speed**: < 1 second for up to 1000 rows
- **Memory Usage**: Minimal, processes one row at a time

### Benchmark Results
- 4 rows: 0.1 seconds
- 50 rows: 0.2 seconds
- 500 rows: 0.5 seconds
- 5000 rows: 2-3 seconds

## Integration Points

### Inputs From
- **Agent2**: Provides `output/output23.xlsx` with grades

### Outputs To
- **Reporting**: `output/output34.xlsx` for final review
- **Further Processing**: Can be used by other systems for analysis or distribution

## Column Specifications

### Input Columns (All from Agent2)
- `ID`: Unique identifier (numeric)
- `Date`: Submission date (MM/DD/YYYY format)
- `Subject`: Email subject (text)
- `Repo URL`: GitHub repository URL (text)
- `Success`: Processing status flag (0 or 1)
- `grade`: Calculated grade 0-100 (numeric, 2 decimals)

### Output Columns
All input columns + new column:
- `greeting`: Personality-style greeting message (text, 100-200 chars typical)

## Excel File Format

- **Format**: .xlsx (Office Open XML)
- **Encoding**: UTF-8
- **Headers**: Row 1, styled with blue background and white font
- **Data Rows**: Starting from Row 2
- **Number Format**: Grades display as numbers with 2 decimal places
- **Text Format**: Greetings display as wrapped text

## Quality Standards

### Data Integrity
- ✓ No data loss from original columns
- ✓ All rows processed (none skipped)
- ✓ Data types preserved correctly
- ✓ Excel formatting maintained

### Message Quality
- ✓ Authentic personality voice
- ✓ Appropriate tone for grade level
- ✓ Motivational and encouraging
- ✓ No offensive or inappropriate content

## Logging and Reporting

Agent3 provides detailed logging:
- File opening and validation
- Row count verification
- Grade distribution (count in each tier)
- Greeting generation summary
- File write status
- Completion message with output path

### Log Example
```
2024-01-15 10:30:00 - INFO - Reading input file: output/output23.xlsx
2024-01-15 10:30:00 - INFO - Found 4 entries
2024-01-15 10:30:00 - INFO - Generating greetings...
2024-01-15 10:30:00 - INFO - Eddie Murphy style (0-60): 2 entries
2024-01-15 10:30:00 - INFO - Donald Trump style (>60): 2 entries
2024-01-15 10:30:00 - INFO - Writing output file: output/output34.xlsx
2024-01-15 10:30:00 - INFO - ✓ Transformation complete!
```

## Troubleshooting Guide

### Issue: "output23.xlsx not found"
1. Verify Agent2 has been run: `ls output/output23.xlsx`
2. Check that Agent2 completed successfully
3. Verify correct working directory

### Issue: "Grade column not found"
1. Open output23.xlsx and verify 'grade' column exists
2. Check for typos in column name (case-sensitive)
3. Verify Agent2 wrote grade data correctly

### Issue: "Non-numeric grade values"
1. Open output23.xlsx and inspect grade column
2. Check for text values or errors
3. Re-run Agent2 if data is corrupted

### Issue: "Permission denied writing output"
1. Check output directory permissions: `ls -ld output/`
2. Make output directory writable: `chmod 755 output/`
3. Verify you have write permissions

## Testing

Run tests to verify Agent3 functionality:

```bash
# Run all tests
python -m pytest -v

# Run specific test file
python -m pytest test_agent3.py -v

# Run with coverage
python -m pytest --cov=. --cov-report=html
```

## Dependencies

- **Python**: 3.9+
- **openpyxl**: Excel file I/O
- **pathlib**: Path handling
- **logging**: Logging system
- **typing**: Type hints

## Configuration Options

All paths are relative to project root:
- Input file: `output/output23.xlsx` (customizable with `--input`)
- Output file: `output/output34.xlsx` (customizable with `--output`)
- Logging level: INFO (DEBUG with `--verbose`)

## Next Steps

After generating `output34.xlsx`:

1. **Review Results**
   - Open output34.xlsx and verify greetings
   - Check for any formatting issues
   - Validate message appropriateness

2. **Distribute**
   - Send individual greeting emails to students
   - Print personalized feedback reports
   - Archive for records

3. **Analyze**
   - Review greeting sentiment and tone
   - Gather feedback from recipients
   - Iterate on message generation if needed

## Future Enhancements

- [ ] Support additional greeting styles/celebrities
- [ ] Customizable grade thresholds
- [ ] Template-based message generation
- [ ] Email integration to send greetings directly
- [ ] Support for multiple personality styles per grade
- [ ] Performance metrics and timing analysis
- [ ] Batch processing with progress reporting
- [ ] Message customization per student

## Support and Documentation

- **README.md**: Overview and features
- **IMPLEMENTATION_SUMMARY.md**: Technical architecture details
- **PLAN.md**: Original specification
- **Test files**: Usage examples and test cases
